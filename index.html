<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Load Modeling Tool</title>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 40px;
            background-color: #f0f3f4;
            color: #333;
        }

        h2 {
            color: #2d3748;
        }

        .container {
            background-color: #e2e8f0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
        }

        .section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }

        input, button {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
        }

        button {
            background-color: #48bb78;
            color: #ffffff;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #38a169;
        }

        #graphExplanation {
            display: none;
            margin-top: 20px;
        }

        #formulaSection {
            display: none;
            margin-top: 20px;
        }
/* Additional Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            border: 1px solid #cbd5e0;
            text-align: center;
        }

        th {
            background-color: #e2e8f0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>Performance Load Modeling Tool</h2>
<div>
        <p>The "Performance Load Modeling Tool" is designed to assist testers and developers in understanding and visualizing the performance load characteristics of an application. Here's what this tool offers:</p>
        <ul>
            <li><strong>Load Distribution Visualization:</strong> By inputting the total number of users expected per day and the desired ramp-up time, this tool provides a graph that showcases how virtual users (VUs) increase over a period of time. This helps in understanding how the load is distributed during testing.</li>
            <li><strong>Formulas:</strong> The tool provides dynamic formulas that change based on the user input, providing insights into the number of VUs that step up every second, 10 seconds, 30 seconds, 60 seconds, and during custom-defined intervals.</li>
            <li><strong>JMeter Aggregate Report Analysis:</strong> This section enables users to upload JMeter aggregate report CSV files to obtain a visual representation of the average response times for different endpoints or labels.</li>
            <li><strong>Performance Degradation Analysis:</strong> By comparing the average response times of an existing application to the response times when a new feature is added, the tool calculates the percentage degradation. This data is vital in understanding how new features might affect the application's performance. Furthermore, intuitive labels provide immediate feedback on whether performance has improved or requires attention.</li>
            <li><strong>Download Feature:</strong> Users can conveniently download the graph visualization along with the formulas as a PDF, making it easy to share or document the results.</li>
        </ul>
        
    </div>

        <label for="usersPerDay">Total Number of Users per Day:</label>
        <input type="number" id="usersPerDay" placeholder="Enter total users per day">

        <label for="customSeconds">Custom Ramp-Up Time (seconds):</label>
        <input type="number" id="customSeconds" placeholder="Enter custom seconds">

        <button onclick="calculate()">Calculate</button>

        <canvas id="rampUpChart" style="margin-top: 20px;"></canvas>

        <div id="graphExplanation">
            <strong>Graph Explanation:</strong>
            <p>The graph represents the ramp-up of virtual users (VUs) over time. The VUs increase steadily during the ramp-up time, remain constant during the peak time, and then decrease during the step-down time. This visualization helps in understanding the distribution of users during a load test.</p>
        </div>

        <div id="formulaSection">
            <strong>Formulas:</strong>
            <ul>
                <li id="formula1"></li>
                <li id="formula2"></li>
                <li id="formula3"></li>
                <li id="formula4"></li>
                <li id="formulaCustom"></li>
            </ul>
        </div>

        <button onclick="downloadContent()">Download as PDF</button>
 <div class="section">
            <h2>JMeter Aggregate Report Analysis</h2>
            <input type="file" id="csvInput">
            <button onclick="generateReport()">Generate Report</button>
            <canvas id="aggregateReportChart" style="margin-top: 20px;"></canvas>
        </div>
<div class="section">
    <h2>Performance Degradation Analysis</h2>
    
    <label for="avgExistingApp">Average Response Time for Existing Application (ms):</label>
    <input type="number" id="avgExistingApp">

    <label for="avgNewFeature">Average Response Time for Existing Application with New Feature (ms):</label>
    <input type="number" id="avgNewFeature">

    <button onclick="generateDegradationTable()">Analyze Performance Degradation</button>
</div>
<table id="resultsTable" style="display:none; border-collapse: collapse; width: 100%;">
    <thead>
        <tr>
            <th style="border: 1px solid black;">Performance Test Type</th>
            <th style="border: 1px solid black;">Average Response Time (ms)</th>
            <th style="border: 1px solid black;">% Degradation</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be appended dynamically -->
    </tbody>
</table>
<p id="performanceMessage" style="font-weight: bold;"></p>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>

    <script>
        let myChart;

        function calculate() {
            const usersPerDay = parseFloat(document.getElementById("usersPerDay").value);
            const customSeconds = parseFloat(document.getElementById("customSeconds").value || 0);

            const usersPerHour = usersPerDay / 24;
            const vusIncreasePerSecond = usersPerHour / 3600;

            const ctx = document.getElementById('rampUpChart').getContext('2d');

            if (myChart) {
                myChart.destroy();
            }

            const rampUpTime = 3600;
            const peakTime = 15 * 60;
            const stepDownTime = 3600;

            const timeLabels = Array.from({ length: rampUpTime + peakTime + stepDownTime }, (_, i) => i + 1);
            const rampUpData = timeLabels.slice(0, rampUpTime).map(second => vusIncreasePerSecond * second);
            const peakData = Array(peakTime).fill(vusIncreasePerSecond * rampUpTime);
            const stepDownData = timeLabels.slice(0, stepDownTime).map(second => vusIncreasePerSecond * (stepDownTime - second));

            const data = [...rampUpData, ...peakData, ...stepDownData];

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [{
                        label: 'VUs over time',
                        data: data,
                        borderColor: '#4c51bf',
                        backgroundColor: 'rgba(76, 81, 191, 0.2)',
                        borderWidth: 0.5
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Time (seconds)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Virtual Users (VUs)'
                            }
                        }
                    }
                }
            });

            document.getElementById("formula1").textContent = `Step-up VUs every 1 second: ${Math.round(vusIncreasePerSecond)} VUs`;
            document.getElementById("formula2").textContent = `Step-up VUs every 10 seconds: ${Math.round(vusIncreasePerSecond * 10)} VUs`;
            document.getElementById("formula3").textContent = `Step-up VUs every 30 seconds: ${Math.round(vusIncreasePerSecond * 30)} VUs`;
            document.getElementById("formula4").textContent = `Step-up VUs every 60 seconds: ${Math.round(vusIncreasePerSecond * 60)} VUs`;
            document.getElementById("formulaCustom").textContent = `Step-up VUs every ${customSeconds} seconds: ${Math.round(vusIncreasePerSecond * customSeconds)} VUs`;

            document.getElementById('graphExplanation').style.display = 'block';
            document.getElementById('formulaSection').style.display = 'block';
        }

        function downloadContent() {
            const canvas = document.getElementById('rampUpChart');
            const imgData = canvas.toDataURL('image/png');

            const docDefinition = {
                content: [{
                    image: imgData,
                    width: 500
                }, {
                    text: 'Formulas:',
                    fontSize: 12,
                    bold: true,
                    margin: [0, 20, 0, 10]
                }, {
                    text: document.getElementById("formula1").textContent,
                    fontSize: 12,
                    margin: [0, 5]
                }, {
                    text: document.getElementById("formula2").textContent,
                    fontSize: 12,
                    margin: [0, 5]
                }, {
                    text: document.getElementById("formula3").textContent,
                    fontSize: 12,
                    margin: [0, 5]
                }, {
                    text: document.getElementById("formula4").textContent,
                    fontSize: 12,
                    margin: [0, 5]
                }, {
                    text: document.getElementById("formulaCustom").textContent,
                    fontSize: 12,
                    margin: [0, 5]
                }, {
                    text: '\nGraph Explanation:',
                    fontSize: 12,
                    bold: true,
                    margin: [0, 20, 0, 10]
                }, {
                    text: 'The graph represents the ramp-up of virtual users (VUs) over time. The VUs increase steadily during the ramp-up time, remain constant during the peak time, and then decrease during the step-down time. This visualization helps in understanding the distribution of users during a load test.',
                    fontSize: 12,
                    margin: [0, 5]
                }]
            };

            pdfMake.createPdf(docDefinition).download('performance-load-model.pdf');
        }
    </script>
    <script>
        let aggregateChart;

        function generateReport() {
            const csvInput = document.getElementById("csvInput");
            const file = csvInput.files[0];

            if (!file) {
                alert('Please select a JMeter Aggregate report CSV file first.');
                return;
            }

            const reader = new FileReader();

            reader.onload = function(event) {
                const csv = event.target.result;
                const lines = csv.split("\n");
                const labels = [];
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    const tokens = lines[i].split(",");
                    if (tokens[0] && tokens[1]) {
                        labels.push(tokens[0]);
                        data.push(parseFloat(tokens[1]));
                    }
                }

                const ctx = document.getElementById('aggregateReportChart').getContext('2d');
                
                if (aggregateChart) {
                    aggregateChart.destroy();
                }

                aggregateChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Avg Response Time (ms)',
                            data: data,
                            backgroundColor: 'rgba(76, 81, 191, 0.2)',
                            borderColor: '#4c51bf',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Endpoint/Label'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Average Response Time (ms)'
                                }
                            }
                        }
                    }
                });
            };
            
            reader.readAsText(file);
        }
    </script>
<!-- Begin of the new feature integration -->
<script>
    
    function generateDegradationTable() {
    const avgExisting = parseFloat(document.getElementById('avgExistingApp').value);
    const avgNewFeature = parseFloat(document.getElementById('avgNewFeature').value);

    // Check if the values are valid numbers
    if (isNaN(avgExisting) || isNaN(avgNewFeature)) {
        alert('Please provide valid average response times.');
        return;
    }

    const degradation = ((avgNewFeature - avgExisting) / avgExisting) * 100;

    const tbody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
    tbody.innerHTML = ''; // Clear the table body

    // Add the existing app data
    const row1 = tbody.insertRow();
    row1.insertCell().innerText = "Existing Application";
    row1.insertCell().innerText = avgExisting;
    row1.insertCell().innerText = ''; // No degradation for the existing app

    // Add the new feature data
    const row2 = tbody.insertRow();
    row2.insertCell().innerText = "Existing Application with New Feature";
    row2.insertCell().innerText = avgNewFeature;
    let degradationCell = row2.insertCell();
    degradationCell.innerText = degradation.toFixed(2) + '%';

    // Style the cells
    Array.from(tbody.getElementsByTagName('td')).forEach(cell => {
        cell.style.border = '1px solid black';
    });

    // Check the performance and display the message accordingly
    const messageElem = document.getElementById('performanceMessage');
    if (degradation < 0) {
        messageElem.style.color = 'green';
        messageElem.innerText = `Performance improved by ${Math.abs(degradation.toFixed(2))}%.`;
    } else {
        degradationCell.style.color = 'red';
        messageElem.style.color = 'red';
        messageElem.innerText = 'Performance needs to be improved for the new feature.';
    }

    // Display the results table
    document.getElementById('resultsTable').style.display = '';
}


</script>
<footer style="margin-top: 20px; text-align: center;">
    Developed by Ilamvazhuthi Mathivanan
</footer>
</body>

</html>
